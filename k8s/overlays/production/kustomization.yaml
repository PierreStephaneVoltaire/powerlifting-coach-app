apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: app

resources:
  - ../../base

patchesStrategicMerge:
  - production-patches.yaml
  - frontend-patch.yaml
  - auth-service-patch.yaml

patchesJson6902:
  - target:
      group: networking.k8s.io
      version: v1
      kind: Ingress
      name: powerlifting-coach-ingress
    patch: |-
      - op: replace
        path: /spec/rules/0/host
        value: app.159.203.50.157.nip.io
      - op: replace
        path: /spec/rules/1/host
        value: api.159.203.50.157.nip.io
      - op: replace
        path: /spec/rules/2/host
        value: auth.159.203.50.157.nip.io

images:
  - name: auth-service
    newName: ghcr.io/pierrestephanevoltaire/powerlifting-coach/auth-service
    newTag: latest
  - name: user-service
    newName: ghcr.io/pierrestephanevoltaire/powerlifting-coach/user-service
    newTag: latest
  - name: video-service
    newName: ghcr.io/pierrestephanevoltaire/powerlifting-coach/video-service
    newTag: latest
  - name: settings-service
    newName: ghcr.io/pierrestephanevoltaire/powerlifting-coach/settings-service
    newTag: latest
  - name: program-service
    newName: ghcr.io/pierrestephanevoltaire/powerlifting-coach/program-service
    newTag: latest
  - name: coach-service
    newName: ghcr.io/pierrestephanevoltaire/powerlifting-coach/coach-service
    newTag: latest
  - name: notification-service
    newName: ghcr.io/pierrestephanevoltaire/powerlifting-coach/notification-service
    newTag: latest
  - name: frontend
    newName: ghcr.io/pierrestephanevoltaire/powerlifting-coach/frontend
    newTag: latest

commonLabels:
  environment: production

replicas:
  # Infrastructure
  - name: postgres
    count: 1
  - name: valkey
    count: 1
  - name: rabbitmq
    count: 1
  # Story 1 & 2 Services
  - name: frontend
    count: 1
  - name: keycloak
    count: 1
  - name: notification-service
    count: 1
  - name: settings-service
    count: 1
  # Disabled Services (not needed for Story 1 & 2)
  - name: auth-service
    count: 0
  - name: coach-service
    count: 0
  - name: dm-service
    count: 0
  - name: machine-service
    count: 0
  - name: program-service
    count: 0
  - name: reminder-service
    count: 0
  - name: user-service
    count: 0
  - name: video-service
    count: 0
  - name: litellm
    count: 0
